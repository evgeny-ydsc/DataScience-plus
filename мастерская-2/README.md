# Проектная работа "Маркетинг" Яндекс Практикума - Евгений С.

2025-04-26

## Постановка задачи

Интернет-магазин собирает историю покупателей, проводит рассылки предложений и
планирует будущие продажи. Для оптимизации процессов надо выделить пользователей,
которые готовы совершить покупку в ближайшее время.

Цель: Предсказать вероятность покупки в течение 90 дней

### Критерии успеха
- метрика roc_auc, минимальный порог не задан


## реализованная модель и выводы



- В соответствии с поставленной задачей (см. первый раздел)
    - была проведена подготовка данных и их разведочный анализ, в результате которых:
        - исправлены типы данных
        - удалены малополезные признаки (в т. ч. с учётом мультиколлинеарности)
        - сконструированы новые признаки агрегирующие статистики для каждого клиента (для которого известен целевыой признак)
        - сконструированы новые признаки по категориям
        - объеденины таблицы покупок и сообщений
        - заполнены пропуски
        - удалены явные дубликаты
    - датасет сильно несбалансированный (в тренировочной выборке 2% класс-1 и 98% класс-0)
        - обучающая выборка была сбалансирована овер и андерсэмплингом
    - была натренирована модель с примененеием pipeline, кроссвалидации и перебора гиперпараметров
        - выбрана наиболее оптимальная модель - **XGBClassifier**, показавшая наилучшие результаты:
            - качество предсказания на тестовой выборке: **roc_auc = 0.72**
            - f1 на валидационной выборке 0.87
            - на тестовой выборке очень высокие **precision=0.98 и recall=0.97 для класса-0**, но крайне низкие **precision=0.09 и recall=0.18 для класса-1**
            - TOP5 наиболее важных признаки, согласно shap:
                - num_msg_top_weekday_6_months
                - num_mean_weekday_ever
                - num_msg_top_weekday_ever
                - num_mean_marker_4_ever
                - num_mean_month_ever
- Попутные наблюдения по покупкам:
    - вероятно, категория 2 и 4 - это "маркером распродажи или маркер женщинам/мужчинам"
    - покупки представлены с 2022 по 2024 включительно (большинство покупок за 2023 год)
    - самые активные месяцы 6, 11, 12 (возможно, отпуска и новый год), наименее актинвые месяцы - 2 и 10
    - наиболее активный день недели - Пт
    - Можно было бы также добавить каналы рекламных баннеров из сайтов/поиска/приложений/видео - это помогло бы предсказывать ещё точнее.
    - по графику распределения видно, что есть 2 пика по значению id и они ближе к левому краю. Из этого можно сделать вывод (в предположении, что id выдавались последовательно), что были две большие волны подключения клиентов, причём они - ближе к началу наблюдаемого периода. Значит рост сервиса замедлился.
- Попутные наблюдения по рассылкам:
    - По распределению видно, что последние кампании рассылок (в предположении, что они нумеруются последовательно) более значительно массивные. Возможно, это связано с предыдущем наблюдением-предположением о замедлении роста сервиса - интерес клиентов стараются привлечь активнее, чем раньше.
    - Видна периодичность рассылок - пики примерно раз в неделю в Пт, а самый неактивный день - Вс.
    - Пик пушей - вечером. Очень много пушей в утреннее время. Очень хочется верить, что это связано с разными рассылкой по разным таймзонам, и что никому в его таймзоне не рассылаются пуши ночью во время сна. 
        - ⚠️[!] стоит написать в выводах продакт менеджерам, на всякий случай, пусть проверят (проверить в датасете это не удастся из-за отсутствия информации о таймзоне клиента).
    - Статистика по сообщениям:
        - send = 9058174
        - open = 3052481
        - click = 483326
        - purchase = 62593
        - hard_bounce = 19763
        - soft_bounce = 10582
        - unsubscribe = 2833
        - hbq_spam = 823
        - complain = 527
        - subscribe = 85
        - close = 1
    

## Инструкция по использованию

Для использования потребуется доработка тетрадки:

### 1. добавить в существующую тетрадку и использовать сохранение натренированной модели
```
# save
with open('my_trained_model.pkl','wb') as f:
    pickle.dump(clf,f)
```

### 2. создать новый python-скрипт или jupiter-тетрадку для использования натренированной модели

Потребуется:
1. загрузить свои аналоги таблиц apparel-purchases.csv и apparel-target_binary.csv
2. повторить все шаги по конструированию признаков
3. загрузить натренированную модель:
```
with open('model.pkl', 'rb') as f:
    clf2 = pickle.load(f)
```
4. получить предсказания:
```
clf2.predict(X[0:1])
```